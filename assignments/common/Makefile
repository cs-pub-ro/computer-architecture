

COMPILER=iverilog
INTERPRETER=vvp
SIMULATOR=gtkwave
FLAGS=-Wall -Winfloop

# TODO: use the command line to pass the following parameters
TOP_MODULE=
SOLUTION_FLAGS=
OTHER_SOURCES=
EVALUATE_FILE=evaluate.out

# compute the filenames
TOP_MODULE_FILE=$(TOP_MODULE).v
TOP_SIM_MODULE_FILE=test_${TOP_MODULE}.v
TOP_MODULE_BIN=$(TOP_MODULE).vvp

SOLUTION_MODULE=sol_${TOP_MODULE}
SOLUTION_MODULE_FILE=${SOLUTION_MODULE}.v
SOLUTION_SIM_MODULE_FILE=test_${SOLUTION_MODULE}.v
SOLUTION_MODULE_BIN=${SOLUTION_MODULE}.vvp

EVALUATE_MODULE=evaluate_${TOP_MODULE}
EVALUATE_MODULE_FILE=${EVALUATE_MODULE}.v
EVALUATE_MODULE_BIN=${EVALUATE_MODULE}.vvp


all: build

build:
	$(COMPILER) $(FLAGS) $(TOP_MODULE_FILE) $(TOP_SIM_MODULE_FILE) $(OTHER_SOURCES) -o $(TOP_MODULE_BIN)
	@echo "Build completed"

build_solution:
	$(COMPILER) $(FLAGS) ${SOLUTION_FLAGS} ${SOLUTION_SIM_MODULE_FILE} ${SOLUTION_MODULE_FILE} $(OTHER_SOURCES) -o $(SOLUTION_MODULE_BIN)

build_evaluate:
	$(COMPILER) $(FLAGS) ${SOLUTION_FLAGS} ${TOP_MODULE_FILE} ${SOLUTION_MODULE_FILE} ${EVALUATE_MODULE_FILE} $(OTHER_SOURCES) -o $(EVALUATE_MODULE_BIN)

run: build
	$(INTERPRETER) $(TOP_MODULE_BIN)

run_solution: build_solution
	$(INTERPRETER) $(SOLUTION_MODULE_BIN)

run_evaluate: build_evaluate
	$(INTERPRETER) $(EVALUATE_MODULE_BIN) > $(EVALUATE_FILE) 2>&1

clean:
	rm *.vvp $(EVALUATE_FILE)
