TESTS_FILE=input.txt
SEQUENCE_FILE=
EVALUATE_FILE=evaluate.out


COMPILER=iverilog
INTERPRETER=vvp
FLAGS=-Wall -Winfloop
TOP_MODULE=fsm

TOP_MODULE_FILE=${TOP_MODULE}.v
TOP_SIM_MODULE_FILE=test_${TOP_MODULE}.v
TOP_MODULE_BIN=$(TOP_MODULE).vvp

EVALUATE_MODULE=evaluate_${TOP_MODULE}
EVALUATE_MODULE_FILE=${EVALUATE_MODULE}.v
EVALUATE_MODULE_BIN=${EVALUATE_MODULE}.vvp

EVALUATE_FLAGS=+INPUT_FILE=$(TESTS_FILE)

GENERATOR_INTERPRETER=python3
GENERATOR_FILE=generate_tests.py

all: build

build:
	$(COMPILER) $(FLAGS) $(TOP_MODULE_FILE) $(TOP_SIM_MODULE_FILE) -o $(TOP_MODULE_BIN)

build_evaluate:
	$(GENERATOR_INTERPRETER) $(GENERATOR_FILE) $(SEQUENCE_FILE) $(TESTS_FILE)
	$(COMPILER) $(FLAGS) ${TOP_MODULE_FILE} ${EVALUATE_MODULE_FILE} -o $(EVALUATE_MODULE_BIN)

run: build
	$(INTERPRETER) $(TOP_MODULE_BIN)

run_evaluate: build_evaluate
	$(INTERPRETER) $(EVALUATE_MODULE_BIN) $(EVALUATE_FLAGS) > $(EVALUATE_FILE) 2>&1

clean:
	rm -f *.vvp $(TESTS_FILE) $(SEQUENCE_FILE) $(EVALUATE_FILE)
